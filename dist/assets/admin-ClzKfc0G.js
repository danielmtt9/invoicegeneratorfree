import{a as t,j as e,R as v,r as y,C as f,S as N}from"./Layout-DQyYZk-h.js";async function d(n){const i=await fetch(n,{headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`Request failed: ${i.status}`);return await i.json()}function g(){const[n,i]=t.useState("24h"),[r,h]=t.useState(null),[o,x]=t.useState(null),[j,l]=t.useState(null),[p,c]=t.useState(!1),m=t.useMemo(()=>({"24h":"Last 24 hours","7d":"Last 7 days","30d":"Last 30 days"})[n],[n]);return t.useEffect(()=>{let s=!0;return c(!0),l(null),Promise.all([d(`/admin-api/summary.php?window=${encodeURIComponent(n)}`),d(`/admin-api/recent.php?window=${encodeURIComponent(n)}&limit=120`)]).then(([a,u])=>{s&&(h(a),x(u))}).catch(a=>{s&&(l(a instanceof Error?a.message:String(a)),h(null),x(null))}).finally(()=>{s&&c(!1)}),()=>{s=!1}},[n]),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"hd",children:e.jsx("h2",{children:m})}),e.jsxs("div",{className:"bd",children:[e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("button",{className:"btn",type:"button",onClick:()=>i("24h"),children:"24h"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>i("7d"),children:"7d"}),e.jsx("button",{className:"btn",type:"button",onClick:()=>i("30d"),children:"30d"})]}),e.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:[e.jsx("a",{className:"btn",href:`/admin-api/export.csv.php?window=${encodeURIComponent(n)}`,children:"Export CSV"}),e.jsx("button",{className:"btn danger",type:"button",onClick:async()=>{c(!0),l(null);try{await d("/admin-api/cleanup.php?run=1");const s=await d(`/admin-api/summary.php?window=${encodeURIComponent(n)}`),a=await d(`/admin-api/recent.php?window=${encodeURIComponent(n)}&limit=120`);h(s),x(a)}catch(s){l(s instanceof Error?s.message:String(s))}finally{c(!1)}},children:"Run cleanup"})]})]}),p&&e.jsx("div",{className:"fineMuted",style:{marginTop:10},children:"Loadingâ€¦"}),j&&e.jsx("div",{className:"fine",style:{marginTop:10,color:"var(--danger)"},children:j}),r&&e.jsxs("div",{style:{display:"grid",gap:12,marginTop:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:12},children:[e.jsxs("div",{className:"panel",style:{background:"var(--paper)"},children:[e.jsx("div",{className:"hd",children:e.jsx("h2",{children:"Page views"})}),e.jsx("div",{className:"bd",children:e.jsx("div",{style:{fontSize:28,fontWeight:700},children:r.page_views})})]}),e.jsxs("div",{className:"panel",style:{background:"var(--paper)"},children:[e.jsx("div",{className:"hd",children:e.jsx("h2",{children:"Unique visitors"})}),e.jsx("div",{className:"bd",children:e.jsx("div",{style:{fontSize:28,fontWeight:700},children:r.unique_visitors})})]}),e.jsxs("div",{className:"panel",style:{background:"var(--paper)"},children:[e.jsx("div",{className:"hd",children:e.jsx("h2",{children:"Total events"})}),e.jsx("div",{className:"bd",children:e.jsx("div",{style:{fontSize:28,fontWeight:700},children:r.total_events})})]})]}),e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"hd",children:e.jsx("h2",{children:"Top pages"})}),e.jsx("div",{className:"bd",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Path"}),e.jsx("th",{className:"num",children:"Count"})]})}),e.jsx("tbody",{children:r.top_pages.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.path}),e.jsx("td",{className:"num",children:s.count})]},s.path))})]})})]}),e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"hd",children:e.jsx("h2",{children:"Top referrers"})}),e.jsx("div",{className:"bd",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Referrer"}),e.jsx("th",{className:"num",children:"Count"})]})}),e.jsx("tbody",{children:r.top_referrers.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.referrer||"(direct)"}),e.jsx("td",{className:"num",children:s.count})]},s.referrer))})]})})]})]})]})]})]}),e.jsxs("div",{className:"panel",children:[e.jsx("div",{className:"hd",children:e.jsx("h2",{children:"Recent events"})}),e.jsxs("div",{className:"bd",children:[o&&e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Event"}),e.jsx("th",{children:"Path"}),e.jsx("th",{children:"Referrer"}),e.jsx("th",{children:"VID"})]})}),e.jsx("tbody",{children:o.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{style:{whiteSpace:"nowrap"},children:s.ts}),e.jsx("td",{children:s.event}),e.jsx("td",{children:s.path}),e.jsx("td",{children:s.referrer||"(direct)"}),e.jsx("td",{style:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace"},children:s.vid})]},`${s.ts}-${a}`))})]})}),!o&&!p&&!j&&e.jsx("div",{className:"fineMuted",children:"No data yet."})]})]})]})}v.createRoot(document.getElementById("root")).render(e.jsx(y.StrictMode,{children:e.jsx(f,{children:e.jsx(N,{title:"Admin dashboard",showNavHome:!1,children:e.jsx(g,{})})})}));
